(function(t,z){window.touchSlider=function(c){function N(a){H.removeClass(c.currentClass).eq(a).addClass(c.currentClass)}function K(a,b){var c=A.current;c!==a&&(a=a!==z?a:c+1,q.to(a,{complete:b}))}function I(a){q.to(A.current+1,{dirX:1,complete:a})}function L(a){q.to(A.current-1,{dirX:-1,complete:a})}function B(){C=!0;D||(clearTimeout(v),v=setTimeout(function(){!q.moving&&!D&&I()},c.delay));return c.container}function O(){clearTimeout(v);C=!1;return c.container}function P(){var a=t(document),b,c,
r=!1,m,g,k,e,n,d,l,h,f,u=function(b){1===b.originalEvent.touches.length&&(k=e=b.pageX=b.originalEvent.touches[0].pageX,l=b.pageY=b.originalEvent.touches[0].pageY,d=f=0,new WebKitCSSMatrix(window.getComputedStyle(p[0]).webkitTransform),g=[0,0,0,k],a.bind(E,s),a.one(F,v),q.moveStart(b))},s=function(a){var b,r;if(a.originalEvent.touches&&y){if(1!==a.originalEvent.touches.length)return;b=a.pageX=a.originalEvent.touches[0].pageX;r=a.pageY=a.originalEvent.touches[0].pageY;d+=Math.abs(b-e);f+=Math.abs(r-
l);if(50<Math.abs(d-f)){var k=d;d=Math.min(100,Math.max(0,d-f));f=Math.min(100,Math.max(0,f-k))}if(b===e)return;c||(d>f?(a.preventDefault(),c=!0):v(a))}else{b=a.pageX;r=a.pageY;if(b===e)return;/msie/.test(navigator.userAgent.toLowerCase())&&a.preventDefault()}n+=Math.abs(b-e);h+=Math.abs(r-l);m.shift();m.push(a.timeStamp);g.shift();g.push(b);q.move(a,e);e=b;l=r},v=function(d){r=!1;if(!d.originalEvent||d.originalEvent.touches)d.pageX=e,d.pageY=l;a.unbind(E,s);for(var c=m.length,f=0,k=0;0<--c;)if(m[c-
1]){var p=g[c]-g[c-1],f=f+Math.abs(p)/(m[c]-m[c-1]);0!==p&&(k=0<p?-1:1)}f/=m.length;q.moveEnd(d,f,k,b,n,h);G=!1;if(4<n+h)w.one("click",function(a){a.preventDefault()})};w.bind(J,function(d){if(!(1<d.which))if(r&&a.triggerHandler(F+"."+x),r=!0,c=!1,b=d.timeStamp,n=h=0,m=[0,0,0,b],d.originalEvent.touches)a.one(J,u);else d.preventDefault(),k=e=d.pageX,l=d.pageY,g=[0,0,0,k],a.bind(E,s),a.one(F+"."+x,v),q.moveStart(d)})}c=c||{};var x=c.namespace||"touchslider",s=t(c.container);if(1!==s.length)s.each(function(){touchSlider({container:this})});
else{c=t.extend({autoplay:!1,delay:3E3,margin:5,viewport:"."+x+"-viewport",prev:"."+x+"-prev",next:"."+x+"-next",pagination:"."+x+"-nav-item",currentClass:x+"-nav-item-current",duration:350,mouseTouch:!0},c);var A={current:0,step:K,next:I,prev:L,start:B,stop:O},y="ontouchstart"in window&&"WebKitCSSMatrix"in window,J="touchstart",E="touchmove",F="touchend",w=t(c.viewport,s),p=c.scroller?t(c.scroller,s):w.children(),f=p.children(),H=t(c.pagination,s);if("absolute"!==p.css("position")){var M=w.height();
w.css({height:M,position:"relative"});p.css({position:"absolute",left:0,height:M,width:1E5})}y||(J="mousedown",E="mousemove",F="mouseup");f.css("position","absolute");var u=y?function(a,b,c){if(b===z)return(new WebKitCSSMatrix(getComputedStyle(a.jquery?a[0]:a).webkitTransform)).e;a.css({webkitTransitionDuration:c?c+"ms":"0",webkitTransform:function(a){return"translate3d("+("number"===typeof b?b:b.call(this,a))+"px,0,0)"}})}:function(a,b){if(b===z)return parseInt((a.jquery?a[0]:a).style.left,10);a.css("left",
b)};y&&f.css({webkitTransitionProperty:"-webkit-transform",webkitTransitionTimingFunction:"cubic-bezier(0,0,0.25,1)"});u(f.not(f[0]),1E4);u(f.eq(0),0);var q=function(){var a=[0],b=[0],s=t.noop;return{moving:!1,init:function(){p.bind("webkitTransitionEnd",function(){s()})},to:function(r,m){m=m||{};r>=f.length?r=0:0>r&&(r=f.length-1);var g=c.duration,k=f.eq(r),e=t.inArray(r,a),n=0;p.stop();q.moving=!0;clearTimeout(v);if(-1!==e)n=b[e];else{var d,l=f.index(k),e=z;if(-1===m.dirX)b.unshift(0),a.unshift(l);
else if(1===m.dirX)b.push(0),a.push(l);else{for(d=a.length-1;0<=d;d--)if(a[d]<l){b.splice(d+1,0,0);a.splice(d+1,0,l);e=0;break}e===z&&(b.unshift(b),a.unshift(l))}e=t.inArray(l,a);if(0===e)n=b[1]-(k.outerWidth()+c.margin),u(k,n),b[e]=n;else if(e===a.length-1)n=b[e-1]+f.eq(a[e-1]).outerWidth()+c.margin,u(k,n),b[e]=n;else{d=k.outerWidth();k.css("opacity",0);n=b[e+1]-Math.round((d+c.margin)/2);b[e]=n;u(k,n);var h=n,l=a.length;for(d=e-1;0<=d;d--)h-=f.eq(a[d]).outerWidth()+c.margin,b[d]=h;h=n;for(d=e+1;d<
l;d++)h+=f.eq(a[d]).outerWidth()+c.margin,b[d]=h;for(d=0;d<l;d++)f.eq(a[d]).animate({left:b[d]},{duration:g,queue:!1,complete:function(){k.is(this)&&k.animate({opacity:1},g)}})}}m.pxInMs&&(g=Math.min(Math.max(Math.round(Math.abs(u(p))/m.pxInMs),100),g));s=function(){u(f.not(k),-1E4);a=[f.index(k)];b=[n];m.complete&&m.complete();q.moving=!1;C&&B()};y?u(p,-n,g):p.animate({left:-n},{duration:g,queue:!1,complete:s});A.current=r;N(r)},stop:function(){y?u(p,u(p)):p.stop()},moveStart:function(c){q.moving=
!0;clearTimeout(v);p.stop();q.startPageX=c.pageX;c=u(p);var m;q.leftCount=c;0===a[0]?0<b[0]+c&&(q.leftCount=c+3*(b[0]+c)):a[a.length-1]===f.length-1&&(m=b[a.length-1]+c,0>m&&(q.leftCount=c+3*m))},move:function(r,m){var g=r.pageX-m,k=u(p);f.eq(a[0]);var e=a.length-1,n=f.eq(a[e]),d,l;q.leftCount+=g;if(0<g)for(;0!==a[0]&&k+b[0]+g>c.margin;)d=f.eq(a[0]-1),l=b[0]-d.outerWidth()-c.margin,u(d,l),b.unshift(l),a.unshift(a[0]-1),e++;if((0<g&&0<k+b[0]+g||0>g&&0<k+b[0])&&0===a[0])g=Math.min(Math.round((q.leftCount+
b[0])/4),w.innerWidth()/2),g-=k+b[0];if(0>g)for(;!n.is(f.last())&&k+b[e]+g+n.outerWidth()+c.margin<w.innerWidth();)d=f.eq(a[e]+1),l=b[e]+n.outerWidth()+c.margin,u(d,l),b.push(l),a.push(a[e++]+1),n=d;if((0<g&&0>k+b[e]||0>g&&0>k+b[e]+g)&&n.is(f.last()))g=Math.max(Math.round((q.leftCount+b[e])/4),-w.innerWidth()/2),g-=k+b[e];u(p,k+g)},moveEnd:function(c,m,g,k,e,n){var d=a.length,l=u(p),h=d-1,s;if(0<b[0]+l)h=0;else if(!(0>b[a.length-1]+l)){s={pxInMs:m};var t;m=d-1;for(var v=w.innerWidth(),h=0;h<d-1;h++)if(t=
b[h]+f.eq(a[h]).outerWidth()+l,0<t&&t>v-(b[h+1]+l)){m=h;break}if(G)h=m;else{l=d-1;t=Math.round(p.offset().left);for(h=0;h<d;h++)if(b[h]+t>c.pageX){l=h-1;break}h=m;m===l&&(1E3>c.timeStamp-k&&e+n>0.05*Math.sqrt(Math.pow(w.height(),2)+Math.pow(v,2)))&&(h=Math.max(0,Math.min(d-1,h+g)))}}h=a[h];q.to(h,s)}}}();q.init();if(y){var G=!1;p.bind("webkitTransitionStart",function(){G=!0});p.bind("webkitTransitionEnd",function(){G=!1})}var D=!1,C=!1,v;w.hover(function(){clearTimeout(v);D=!0},function(){D=!1;C&&
B()});H.click(function(){K(H.index(this))});t(c.prev,s).click(function(){L()});t(c.next,s).click(function(){I()});c.mouseTouch&&P();c.autoplay&&B();s.data(x,A)}};t.fn.touchSlider=function(c){c=c||{};c.container=this;touchSlider(c);return this}})(jQuery);
